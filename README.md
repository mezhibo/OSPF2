**Задание 1**

Исходя из топологии на картинке, определите тип всех маршрутизаторов (internal, backbone, ABR). Файл с изначальной конфигурацией маршрутизаторов можете найти здесь

![alt text](https://github.com/mezhibo/OSPF2/blob/16162d9cfc8686259e106c3c0c3d7a53e21a60f6/IMG/1.png)

Приведите список маршрутизаторов R1, R2, R3, R4, R5, R6, R7 c указанием их типов.



**Решение 1**


 - R1, R5 - internal, backbone;
 
 - R2, R3 - ABR (area border router), backbone;
 
 - R4, R6, R7 - internal.



**Задание 2**

По топологии из Задания 1, определите метрику маршрута на маршрутизаторе R1 для сети 4.4.4.4/32 маршрутизатора R4 через путь R1-R2-R4 и R1-R3-R4.

1. Какая метрика будет у данных маршрутов?

2. Какой или какие из этих маршрутов будут установлены в таблицу маршрутизатора R1? Для оптимальной передачи трафика, маршрут до 4.4.4.4 должен проходить только через R1-R3-R4.

3. Является ли ситуация в таблице маршрутизации оптимальной? Если нет, то каким образом можно исправить ситуацию и на каких маршрутизаторах необходимо внести изменения? На маршрутизаторах сделана конфигурация для анонса сети и установления соседства. Дополнительные настройки по умолчанию.

Приведите ответы на вопросы в свободной форме. В вопросе 3, если необходима конфигурация на маршрутизаторах, то приведите команды, которые необходимо применить и на каких маршрутизаторах.



**Решение 2**


1. Метрики по данным маршрутам равны между собой и имеют значение 3. Данное правило счета действует при дефолтных настройках параметра reference-bandwidth = 100, так как в этом случае различий в метрике OSPF между 100Mbps и 1Gbps и выше нет.

2. Поскольку метрики маршрутов равны, оба будут в таблице маршрутизации. В таком случае используется балансировка нагрузки (Equal-cost multi-path, ECMP), что не является оптимальным решением. Для оптимизации топологии необходима настройка Reference bandwidth.

3.Таблица маршрутизации не оптимальна, есть узкое место на линке со скоростью 100Mbps, при возможности использовать 1Gbps. В таких случаях best practice является настройка на всех маршрутизаторах значения эталонной пропускной способности (Reference bandwidth), равной наибольшей из существующих или проектируемых. В данном случае это 10Gbps. Выполняется на всех маршрутизаторах сети командой Router(config-router)#auto-cost reference-bandwidth 10000.




**Задание 3**

По топологии из Задания 1, сеть 172.16.1.0/24 анонсируется в OSPF через R4 и R5.

1. Какой путь или пути ( R1-R5, R1-R2-R4, R1-R3-R4) выберет R1 для данного маршрута? Почему? Соседства между R4-R5 нет.

2. Какие метрики для данного маршрута будет у R1 для данного маршрута через каждый путь? Конфигурация по умолчанию.

3. Какие изменения конфигурации необходимо сделать, чтоб правильно учитывалась пропускная способность каждого линка на этих путях?

4. После того, как будет учитываться правильно каждый линк, изменится ли ситуация с выбором маршрута на R1? Почему?

Приведите ответы на вопросы в свободной форме. В вопросе 3, напишите точно какую/какие команды необходимо использовать на маршрутизаторах





**Решение 3**

1. R1 выберет путь R1-R5, т.к. внутренние маршруты зоны (intra-area) это наиболее приоритетный тип, чем внешние маршруты через ABR. Стоимости маршрутов разного типа не сравниваются.

2. При настройках по умолчанию до сети 172.16.1.0:

- R1-R5 метрика равна 110;

- R1-R2-R4 метрика равна 4, как и для R1-R3-R4.

3. На всех маршрутизаторах изменить значение Reference bandwidth, задав 10000, команда auto-cost reference-bandwidth 10000. Метрики буду следующими:

- R1-R5 = 11000;

- R1-R2-R4 = 301;

- R1-R3-R4 = 211.

4. Даже после правильного учета метрики, ситуация с выбором маршрута не поменяется, приоритетным по-прежнему останется R1-R5, так как он является внутренним маршрутом. Возможно, нужно настроить еще одну зону для сети 172.16.1.0/24 и сделать R5 пограничным.

